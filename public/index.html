<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Trash</title>
    <meta name="description" content="An image uploader">
    <link id="favicon" rel="icon" href="https://glitch.com/edit/favicon-app.ico" type="image/x-icon">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="/script.js" defer></script>
    
    <link rel="stylesheet" href="/style.css">
    <script>
      window.onload= async ()=>{
        const displayTrash = async () => {
          let data = await fetch('/list').then(response=>response.json())
        
          console.log(data)
          
          let input = document.querySelector('input')
          // let download = document.querySelector('#download')
          let trash = document.querySelector('#trash')
          // let mycanvas = document.querySelector('#mycanvas')
          // if (trash.className === "empty") {
            // console.log("empty")
            // mycanvas.innerHTML = "Drop your trash into the trash can."
            // input.addEventListener('mouseenter', () => {
            //   mycanvas.style.display = "block"
            // });
            // input.addEventListener('mouseout', () => {
            //   mycanvas.style.display = "none"
            // });
          // }
          // else {
          //   // console.log("full")
          //   mycanvas.innerHTML = "Empty the trash by clicking."
          //   download.addEventListener('mouseenter', () => {
          //     mycanvas.style.display = "block"
          //   });
          //   download.addEventListener('mouseout', () => {
          //     mycanvas.style.display = "none"
          //   });
          // }
          
          if(data.length > 0) {
            //something has been stored
            let file = data[0].filepath
            console.log(file)

            document.querySelector("#trash").classList.remove("empty")
            document.querySelector("#trash").classList.add("full")
            document.querySelector("input,button").classList.add("hide")
                        
            let download = `<a id="download" href="${file}" title="empty trash can" download></a>`
            document.querySelector("label").insertAdjacentHTML("beforeend", download)

            let downloadButton = document.querySelector('#download')
            // mycanvas.innerHTML = "Empty the trash by clicking."
            // downloadButton.addEventListener('mouseenter', () => {
            //   mycanvas.style.display = "block"
            // });
            // downloadButton.addEventListener('mouseout', () => {
            //   mycanvas.style.display = "none"
            // });
            
            
            document.querySelector("#download").addEventListener("click", async (e)=>{
              // var audio = new Audio('https://cdn.glitch.com/d5c04b6f-97ab-47d6-b1d3-4f165f94771f%2F01%20One%20for%20Ghost.mp3?v=1607213736036');
              let audio = document.querySelector("#empty")
              audio.play()
              
              //animation
              
              async function refreshPage() {
                
                let removed = await fetch("/remove")
                console.log("Deleted...")
             
                window.location.href = "/"
              }
              
              setTimeout(refreshPage, 1000)
              
              

            })

          }


        }
        
        
        
        
        $("#image").click(function(e) {
            e.preventDefault();
        });
        
        // feature detection for drag&drop upload
        var isAdvancedUpload = function() {
          var div = document.createElement( 'div' );
          return ( ( 'draggable' in div ) || ( 'ondragstart' in div && 'ondrop' in div ) ) && 'FormData' in window && 'FileReader' in window;
        }();
        
        var $form = $('#imageUploader');

        if (isAdvancedUpload) {
          // $form.addClass('has-advanced-upload');
          var droppedFiles = false;

          $form.on('drag dragstart dragend dragover dragenter dragleave drop', function(e) {
            // e.preventDefault();
            e.stopPropagation();
          })
          .on('dragover dragenter', function() {
            $form.addClass('is-dragover');
          })
          .on('dragleave dragend drop', function() {
            $form.removeClass('is-dragover');
          })
          .on('drop', async function(e) {
            droppedFiles = e.originalEvent.dataTransfer.files;
    
            console.log(droppedFiles)

            let form = document.forms.namedItem("imageUploader")
            
            const formData = new FormData()
            
            formData.append('image', droppedFiles[0])
            // formData.append("file", droppedFiles)
            
                      
            
            let submission = await fetch("/upload", {
              method: 'POST',
              body: formData
            })
            
            console.log(submission)
            
            await displayTrash();
            let audio = document.querySelector("#move")
            audio.play()
                        
          });
         
          //change cursor use canvas
          
//           function Thing(x, y)
//           {
//           	this.x = x;
//           	this.y = y;
//           }
          
//           var mousePos = new Thing(0, 0);
          
//               mydiv = document.getElementById("mydiv");
//                         mycanvas = document.getElementById("mycanvas");
              
//               mydiv.addEventListener('mousemove', function(event)
//           	{
//           		mousePos.x = event.clientX;
//           		mousePos.y = event.clientY;
                  
//                   mycanvas.style.top = mousePos.y + "px";
//                   mycanvas.style.left = mousePos.x + "px";
//                   console.log(mycanvas.style);
//           	}, false);
                    
        }
        
        
 
        const routes = [
            // {url:'/display',text:'List all file names'},
            {url:'/display.html',text:'Preview all files with inline images'},
            {url:'/list',text:'JSON list of all files, ordered by filename'},
            // {url:'/listByTimestamp',text:'JSON list of all files, ordered by file timestamp'},
            {url:'/remove',text:'Delete all images'}
        ]

        let routesListItems = ''

        for(let route of routes ) {
            routesListItems += `<li><a href="${route.url}">${route.text}</li>`
        }

        const routesList = `<ul>${routesListItems}</ul>`
        // document.querySelector("nav").insertAdjacentHTML('beforeend', routesList)
        
        
        
        await displayTrash()
        
        
        
        
        
        
 
      }
    </script>

    
    
  </head>
  <body>    
    
<!--     <div id="trash" class="empty" ondrop="dropHandler(event)"></div> -->
    
    <form id="imageUploader" name="imageUploader" method="post" action="/upload" enctype="multipart/form-data">
      <label id="trash" class="empty"></label>
      <input type="file" name="image" id="image" data-multiple-caption="{count} files selected" title="drag & drop to upload" multiple />
      <button type="submit">Upload</button>
    </form>
    
    <div id="mydiv">
<!--       <div id="mycanvas"></div> -->
    </div>
  
    <audio id="move">
        <source src="https://cdn.glitch.com/d5c04b6f-97ab-47d6-b1d3-4f165f94771f%2Fmove%20to%20trash_01.mp3?v=1607215840191">
    </audio>
    <audio id="empty">
        <source src="https://cdn.glitch.com/d5c04b6f-97ab-47d6-b1d3-4f165f94771f%2Fempty%20trash_01.mp3?v=1607215631394">
    </audio>
    
<!--     <form id="imageUploader" action="/upload" method="post" enctype="multipart/form-data">
      <label for="image">Image to upload</label>
      <input type="file" name="image" id="image" />
      <label for="description">Description of the file</label>
      <textarea name="description" id="description"></textarea>
      <input type="submit" />
    </form> -->
    
    <div id="about">
      <a id="about-btn">ğŸ”´</a> 
      <span id="language">
        <a id="about-link-en">about</a> / <a id="about-link-ch">å…³äº</a>
      </span>
      <ul id="about-en">
        <li>
          trash-can.site is an online sharing trash can.
        </li> 
        <li>
          Click to empty the trash can first before you can drag and drop your file into it. By emptying the trash can, the 'trash' file will be deleted from the trash can and downloaded into your computer.
        </li> 
        <li>
          This is a very small trash can that can only hold up to one single file. You can drag and drop any file that is less than 250MB into the trash can. 
        </li> 
        <li>
          It will take a few moments for your file to be uploaded successfully to the trash can depending on the size of your file. Try refreshing the page if your file didn't upload automatically.
        </li> 
        <li>
          Trash-can.site does not generate content and is not responsible for any files it's holding. All the files you download from trash-can.site is from a previous visitor. So please beware of the file you drop into the website will become public and potentially downloaded by another visitor. Your cooperation on the principle of legality and publicity is essential to us.
        </li> 
        <li>
          Website by Churong Mao
        </li> 
      </ul>
      <ul id="about-ch">
        <li>
          trash-can.siteæ˜¯ä¸€ä¸ªåœ¨çº¿å…±äº«åƒåœ¾æ¡¶ã€‚
        </li> 
        <li>
          è¯·å•å‡»ä»¥å…ˆæ¸…ç©ºåƒåœ¾æ¡¶ï¼Œç„¶åæ‰èƒ½å°†æ–‡ä»¶æ‹–æ”¾åˆ°å…¶ä¸­ã€‚é€šè¿‡æ¸…ç©ºåƒåœ¾æ¡¶ï¼Œâ€œåƒåœ¾â€å°†ä»åƒåœ¾æ¡¶ä¸­åˆ é™¤å¹¶ä¸‹è½½åˆ°æ‚¨ç”µè„‘ä¸­ã€‚
        </li> 
        <li>
          è¿™æ˜¯ä¸€ä¸ªéå¸¸å°çš„åƒåœ¾æ¡¶ï¼Œåªèƒ½å®¹çº³ä¸€ä¸ªæ–‡ä»¶ã€‚æ‚¨å¯ä»¥å°†ä»»ä½•å°äº250MBçš„æ–‡ä»¶æ‹–æ”¾åˆ°åƒåœ¾æ¡¶ä¸­ã€‚ 
        </li> 
        <li>
          æ ¹æ®æ–‡ä»¶çš„å¤§å°ï¼Œæ‚¨çš„æ–‡ä»¶æˆåŠŸä¸Šä¼ åˆ°åƒåœ¾æ¡¶éœ€è¦ä¸€äº›æ—¶é—´ã€‚å¦‚æœæ‚¨çš„æ–‡ä»¶æ²¡æœ‰è‡ªåŠ¨ä¸Šä¼ ï¼Œè¯·å°è¯•åˆ·æ–°é¡µé¢ã€‚
        </li> 
        <li>
          trash-can.siteä¸ç”Ÿæˆä»»ä½•å†…å®¹ï¼Œä¹Ÿä¸å¯¹å­˜æ”¾å…¶ä¸­çš„ä»»ä½•æ–‡ä»¶è´Ÿè´£ã€‚æ‚¨ä»trash-can.siteä¸‹è½½çš„æ‰€æœ‰æ–‡ä»¶éƒ½æ¥è‡ªäºä¹‹å‰è®¿é—®è€…çš„ä¸Šä¼ ã€‚å› æ­¤ï¼Œè¯·æ³¨æ„æ‚¨æ”¾å…¥ç½‘ç«™çš„æ–‡ä»¶å°†å…¬å¼€å¹¶å¯èƒ½è¢«å…¶ä»–è®¿é—®è€…ä¸‹è½½ã€‚æ‚¨åœ¨é€‰æ‹©ä¸Šä¼ æ–‡ä»¶æ—¶è‡ªè§‰éµå¾ªåˆæ³•çš„åŸåˆ™å¯¹æˆ‘ä»¬è‡³å…³é‡è¦ã€‚
        </li> 
        <li>
          Website by Churong Mao
        </li> 
      </ul>
    </div>
    

    <nav></nav>
  </body>
</html>